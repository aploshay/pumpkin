<% single_fields = PlumSchema.edit_fields.select { |p| !f.object.model_class.multiple?(p) }.map(&:to_sym) %>
<% multi_fields = PlumSchema.edit_fields - single_fields %>
<div class="row">
  <% [{ header: 'Single-valued Metadata Fields',
        id: 'single-metadata',
        args: {},
        fields: single_fields },
      { header: 'Multi-valued Metadata Fields',
        id: 'multi-metadata',
        args: { as: :multi_value },
        fields: multi_fields }].each do |fieldset| %>
    <% if fieldset[:fields].any? %>
      <div class="col-md-6">
        <fieldset class="optional prompt">
          <legend><%= fieldset[:header] %></legend>
          <% fieldset[:fields].each do |display_field| %>
          <% begin %>
            <%= f.input display_field, **fieldset[:args] %>
          <% rescue %>
            <%= "Error displaying: #{display_field}<br/>".html_safe %>
          <% end %>
        <% end %>
        </fieldset>
      </div>
    <% end %>
  <% end %>
</div>

<fieldset class="optional prompt">
  <legend>Additional Metadata</legend>
  <div class="col-md-6" id="single-metadata"%>
  <% single_fields = PlumSchema.edit_fields.select { |p| !f.object.model_class.multiple?(p) }.map(&:to_sym) %>
  <% single_fields.each do |display_field| %>
    <% begin %>
      <%= f.input display_field %>
    <% rescue %>
      <%= "Error displaying: #{display_field}<br/>".html_safe %>
    <% end %>
  <% end %>
  </div>
  <div class="col-md-6" id="multi-metadata"%>
  <h2>Multi-valued Fields</h2>
  <% (PlumSchema.edit_fields - single_fields).each do |display_field| %>
    <% begin %>
      <%= f.input display_field, as: :multi_value %>
    <% rescue %>
      <%= "Error displaying: #{display_field}<br/>".html_safe %>
      <% @failed_fields << display_field %>
    <% end %>
  <% end %>
  </div>
</fieldset>
